/* esm.sh - esbuild bundle(d3-brush@3.0.0) esnext production */
import{dispatch as Dt}from"/v124/d3-dispatch@3.0.1/esnext/d3-dispatch.mjs";import{dragDisable as Xt,dragEnable as Yt}from"/v124/d3-drag@3.0.0/esnext/d3-drag.mjs";import{interpolate as St}from"/v124/d3-interpolate@3.0.1/esnext/d3-interpolate.mjs";import{pointer as bt,select as W}from"/v124/d3-selection@3.0.0/esnext/d3-selection.mjs";import{interrupt as dt}from"/v124/d3-transition@3.0.1/esnext/d3-transition.mjs";var Z=t=>()=>t;function rt(t,{sourceEvent:_,target:I,selection:R,mode:S,dispatch:P}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:_,enumerable:!0,configurable:!0},target:{value:I,enumerable:!0,configurable:!0},selection:{value:R,enumerable:!0,configurable:!0},mode:{value:S,enumerable:!0,configurable:!0},_:{value:P}})}function mt(t){t.stopImmediatePropagation()}function $(t){t.preventDefault(),t.stopImmediatePropagation()}var yt={name:"drag"},it={name:"space"},V={name:"handle"},G={name:"center"},{abs:gt,max:k,min:x}=Math;function wt(t){return[+t[0],+t[1]]}function ut(t){return[wt(t[0]),wt(t[1])]}var tt={name:"x",handles:["w","e"].map(q),input:function(t,_){return t==null?null:[[+t[0],_[0][1]],[+t[1],_[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},et={name:"y",handles:["n","s"].map(q),input:function(t,_){return t==null?null:[[_[0][0],+t[0]],[_[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Mt={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(q),input:function(t){return t==null?null:ut(t)},output:function(t){return t}},Y={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},vt={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},kt={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Tt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Kt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function q(t){return{type:t}}function Ot(t){return!t.ctrlKey&&!t.button}function Pt(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Bt(){return navigator.maxTouchPoints||"ontouchstart"in this}function st(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Ct(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Nt(t){var _=t.__brush;return _?_.dim.output(_.selection):null}function Vt(){return at(tt)}function Gt(){return at(et)}function It(){return at(Mt)}function at(t){var _=Pt,I=Ot,R=Bt,S=!0,P=Dt("start","brush","end"),D=6,j;function p(e){var n=e.property("__brush",Et).selectAll(".overlay").data([q("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Y.overlay).merge(n).each(function(){var r=st(this).extent;W(this).attr("x",r[0][0]).attr("y",r[0][1]).attr("width",r[1][0]-r[0][0]).attr("height",r[1][1]-r[0][1])}),e.selectAll(".selection").data([q("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Y.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=e.selectAll(".handle").data(t.handles,function(r){return r.type});s.exit().remove(),s.enter().append("rect").attr("class",function(r){return"handle handle--"+r.type}).attr("cursor",function(r){return Y[r.type]}),e.each(N).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",lt).filter(R).on("touchstart.brush",lt).on("touchmove.brush",xt).on("touchend.brush touchcancel.brush",_t).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.move=function(e,n,s){e.tween?e.on("start.brush",function(r){B(this,arguments).beforestart().start(r)}).on("interrupt.brush end.brush",function(r){B(this,arguments).end(r)}).tween("brush",function(){var r=this,u=r.__brush,a=B(r,arguments),E=u.selection,X=t.input(typeof n=="function"?n.apply(this,arguments):n,u.extent),l=St(E,X);function z(o){u.selection=o===1&&X===null?null:l(o),N.call(r),a.brush()}return E!==null&&X!==null?z:z(1)}):e.each(function(){var r=this,u=arguments,a=r.__brush,E=t.input(typeof n=="function"?n.apply(r,u):n,a.extent),X=B(r,u).beforestart();dt(r),a.selection=E===null?null:E,N.call(r),X.start(s).brush(s).end(s)})},p.clear=function(e,n){p.move(e,null,n)};function N(){var e=W(this),n=st(this).selection;n?(e.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(s){return s.type[s.type.length-1]==="e"?n[1][0]-D/2:n[0][0]-D/2}).attr("y",function(s){return s.type[0]==="s"?n[1][1]-D/2:n[0][1]-D/2}).attr("width",function(s){return s.type==="n"||s.type==="s"?n[1][0]-n[0][0]+D:D}).attr("height",function(s){return s.type==="e"||s.type==="w"?n[1][1]-n[0][1]+D:D})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function B(e,n,s){var r=e.__brush.emitter;return r&&(!s||!r.clean)?r:new ot(e,n,s)}function ot(e,n,s){this.that=e,this.args=n,this.state=e.__brush,this.active=0,this.clean=s}ot.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(e,n){return this.starting?(this.starting=!1,this.emit("start",e,n)):this.emit("brush",e),this},brush:function(e,n){return this.emit("brush",e,n),this},end:function(e,n){return--this.active===0&&(delete this.state.emitter,this.emit("end",e,n)),this},emit:function(e,n,s){var r=W(this.that).datum();P.call(e,this.that,new rt(e,{sourceEvent:n,target:p,selection:t.output(this.state.selection),mode:s,dispatch:P}),r)}};function lt(e){if(j&&!e.touches||!I.apply(this,arguments))return;var n=this,s=e.target.__data__.type,r=(S&&e.metaKey?s="overlay":s)==="selection"?yt:S&&e.altKey?G:V,u=t===et?null:Tt[s],a=t===tt?null:Kt[s],E=st(n),X=E.extent,l=E.selection,z=X[0][0],o,m,M=X[0][1],b,d,T=X[1][0],y,g,K=X[1][1],w,v,c=0,f=0,nt,J=u&&a&&S&&e.shiftKey,Q,U,A=Array.from(e.touches||[e],i=>{let h=i.identifier;return i=bt(i,n),i.point0=i.slice(),i.identifier=h,i});dt(n);var F=B(n,arguments,!0).beforestart();if(s==="overlay"){l&&(nt=!0);let i=[A[0],A[1]||A[0]];E.selection=l=[[o=t===et?z:x(i[0][0],i[1][0]),b=t===tt?M:x(i[0][1],i[1][1])],[y=t===et?T:k(i[0][0],i[1][0]),w=t===tt?K:k(i[0][1],i[1][1])]],A.length>1&&C(e)}else o=l[0][0],b=l[0][1],y=l[1][0],w=l[1][1];m=o,d=b,g=y,v=w;var ct=W(n).attr("pointer-events","none"),H=ct.selectAll(".overlay").attr("cursor",Y[s]);if(e.touches)F.moved=ht,F.ended=pt;else{var ft=W(e.view).on("mousemove.brush",ht,!0).on("mouseup.brush",pt,!0);S&&ft.on("keydown.brush",At,!0).on("keyup.brush",zt,!0),Xt(e.view)}N.call(n),F.start(e,r.name);function ht(i){for(let h of i.changedTouches||[i])for(let L of A)L.identifier===h.identifier&&(L.cur=bt(h,n));if(J&&!Q&&!U&&A.length===1){let h=A[0];gt(h.cur[0]-h[0])>gt(h.cur[1]-h[1])?U=!0:Q=!0}for(let h of A)h.cur&&(h[0]=h.cur[0],h[1]=h.cur[1]);nt=!0,$(i),C(i)}function C(i){let h=A[0],L=h.point0;var O;switch(c=h[0]-L[0],f=h[1]-L[1],r){case it:case yt:{u&&(c=k(z-o,x(T-y,c)),m=o+c,g=y+c),a&&(f=k(M-b,x(K-w,f)),d=b+f,v=w+f);break}case V:{A[1]?(u&&(m=k(z,x(T,A[0][0])),g=k(z,x(T,A[1][0])),u=1),a&&(d=k(M,x(K,A[0][1])),v=k(M,x(K,A[1][1])),a=1)):(u<0?(c=k(z-o,x(T-o,c)),m=o+c,g=y):u>0&&(c=k(z-y,x(T-y,c)),m=o,g=y+c),a<0?(f=k(M-b,x(K-b,f)),d=b+f,v=w):a>0&&(f=k(M-w,x(K-w,f)),d=b,v=w+f));break}case G:{u&&(m=k(z,x(T,o-c*u)),g=k(z,x(T,y+c*u))),a&&(d=k(M,x(K,b-f*a)),v=k(M,x(K,w+f*a)));break}}g<m&&(u*=-1,O=o,o=y,y=O,O=m,m=g,g=O,s in vt&&H.attr("cursor",Y[s=vt[s]])),v<d&&(a*=-1,O=b,b=w,w=O,O=d,d=v,v=O,s in kt&&H.attr("cursor",Y[s=kt[s]])),E.selection&&(l=E.selection),Q&&(m=l[0][0],g=l[1][0]),U&&(d=l[0][1],v=l[1][1]),(l[0][0]!==m||l[0][1]!==d||l[1][0]!==g||l[1][1]!==v)&&(E.selection=[[m,d],[g,v]],N.call(n),F.brush(i,r.name))}function pt(i){if(mt(i),i.touches){if(i.touches.length)return;j&&clearTimeout(j),j=setTimeout(function(){j=null},500)}else Yt(i.view,nt),ft.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ct.attr("pointer-events","all"),H.attr("cursor",Y.overlay),E.selection&&(l=E.selection),Ct(l)&&(E.selection=null,N.call(n)),F.end(i,r.name)}function At(i){switch(i.keyCode){case 16:{J=u&&a;break}case 18:{r===V&&(u&&(y=g-c*u,o=m+c*u),a&&(w=v-f*a,b=d+f*a),r=G,C(i));break}case 32:{(r===V||r===G)&&(u<0?y=g-c:u>0&&(o=m-c),a<0?w=v-f:a>0&&(b=d-f),r=it,H.attr("cursor",Y.selection),C(i));break}default:return}$(i)}function zt(i){switch(i.keyCode){case 16:{J&&(Q=U=J=!1,C(i));break}case 18:{r===G&&(u<0?y=g:u>0&&(o=m),a<0?w=v:a>0&&(b=d),r=V,C(i));break}case 32:{r===it&&(i.altKey?(u&&(y=g-c*u,o=m+c*u),a&&(w=v-f*a,b=d+f*a),r=G):(u<0?y=g:u>0&&(o=m),a<0?w=v:a>0&&(b=d),r=V),H.attr("cursor",Y[s]),C(i));break}default:return}$(i)}}function xt(e){B(this,arguments).moved(e)}function _t(e){B(this,arguments).ended(e)}function Et(){var e=this.__brush||{selection:null};return e.extent=ut(_.apply(this,arguments)),e.dim=t,e}return p.extent=function(e){return arguments.length?(_=typeof e=="function"?e:Z(ut(e)),p):_},p.filter=function(e){return arguments.length?(I=typeof e=="function"?e:Z(!!e),p):I},p.touchable=function(e){return arguments.length?(R=typeof e=="function"?e:Z(!!e),p):R},p.handleSize=function(e){return arguments.length?(D=+e,p):D},p.keyModifiers=function(e){return arguments.length?(S=!!e,p):S},p.on=function(){var e=P.on.apply(P,arguments);return e===P?p:e},p}export{It as brush,Nt as brushSelection,Vt as brushX,Gt as brushY};
//# sourceMappingURL=d3-brush.mjs.map